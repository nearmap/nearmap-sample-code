{"version":3,"file":"clusters-dynamic.js","mappings":"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","sources":["webpack:///./clusters-dynamic.js"],"sourcesContent":["import Feature from '../src/ol/Feature.js';\nimport GeoJSON from '../src/ol/format/GeoJSON.js';\nimport Map from '../src/ol/Map.js';\nimport View from '../src/ol/View.js';\nimport {\n  Circle as CircleStyle,\n  Fill,\n  Icon,\n  Stroke,\n  Style,\n  Text,\n} from '../src/ol/style.js';\nimport {Cluster, Vector as VectorSource, XYZ} from '../src/ol/source.js';\nimport {LineString, Point, Polygon} from '../src/ol/geom.js';\nimport {Tile as TileLayer, Vector as VectorLayer} from '../src/ol/layer.js';\nimport {createEmpty, extend, getWidth} from '../src/ol/extent.js';\nimport {fromLonLat} from '../src/ol/proj.js';\n\nconst circleDistanceMultiplier = 1;\nconst circleFootSeparation = 28;\nconst circleStartAngle = Math.PI / 2;\n\nconst convexHullFill = new Fill({\n  color: 'rgba(255, 153, 0, 0.4)',\n});\nconst convexHullStroke = new Stroke({\n  color: 'rgba(204, 85, 0, 1)',\n  width: 1.5,\n});\nconst outerCircleFill = new Fill({\n  color: 'rgba(255, 153, 102, 0.3)',\n});\nconst innerCircleFill = new Fill({\n  color: 'rgba(255, 165, 0, 0.7)',\n});\nconst textFill = new Fill({\n  color: '#fff',\n});\nconst textStroke = new Stroke({\n  color: 'rgba(0, 0, 0, 0.6)',\n  width: 3,\n});\nconst innerCircle = new CircleStyle({\n  radius: 14,\n  fill: innerCircleFill,\n});\nconst outerCircle = new CircleStyle({\n  radius: 20,\n  fill: outerCircleFill,\n});\nconst darkIcon = new Icon({\n  src: 'data/icons/emoticon-cool.svg',\n});\nconst lightIcon = new Icon({\n  src: 'data/icons/emoticon-cool-outline.svg',\n});\n\n/**\n * Single feature style, users for clusters with 1 feature and cluster circles.\n * @param {Feature} clusterMember A feature from a cluster.\n * @return {Style} An icon style for the cluster member's location.\n */\nfunction clusterMemberStyle(clusterMember) {\n  return new Style({\n    geometry: clusterMember.getGeometry(),\n    image: clusterMember.get('LEISTUNG') > 5 ? darkIcon : lightIcon,\n  });\n}\n\nlet clickFeature, clickResolution;\n/**\n * Style for clusters with features that are too close to each other, activated on click.\n * @param {Feature} cluster A cluster with overlapping members.\n * @param {number} resolution The current view resolution.\n * @return {Style} A style to render an expanded view of the cluster members.\n */\nfunction clusterCircleStyle(cluster, resolution) {\n  if (cluster !== clickFeature || resolution !== clickResolution) {\n    return;\n  }\n  const clusterMembers = cluster.get('features');\n  const centerCoordinates = cluster.getGeometry().getCoordinates();\n  return generatePointsCircle(\n    clusterMembers.length,\n    cluster.getGeometry().getCoordinates(),\n    resolution\n  ).reduce((styles, coordinates, i) => {\n    const point = new Point(coordinates);\n    const line = new LineString([centerCoordinates, coordinates]);\n    styles.unshift(\n      new Style({\n        geometry: line,\n        stroke: convexHullStroke,\n      })\n    );\n    styles.push(\n      clusterMemberStyle(\n        new Feature({\n          ...clusterMembers[i].getProperties(),\n          geometry: point,\n        })\n      )\n    );\n    return styles;\n  }, []);\n}\n\n/**\n * From\n * https://github.com/Leaflet/Leaflet.markercluster/blob/31360f2/src/MarkerCluster.Spiderfier.js#L55-L72\n * Arranges points in a circle around the cluster center, with a line pointing from the center to\n * each point.\n * @param {number} count Number of cluster members.\n * @param {Array<number>} clusterCenter Center coordinate of the cluster.\n * @param {number} resolution Current view resolution.\n * @return {Array<Array<number>>} An array of coordinates representing the cluster members.\n */\nfunction generatePointsCircle(count, clusterCenter, resolution) {\n  const circumference =\n    circleDistanceMultiplier * circleFootSeparation * (2 + count);\n  let legLength = circumference / (Math.PI * 2); //radius from circumference\n  const angleStep = (Math.PI * 2) / count;\n  const res = [];\n  let angle;\n\n  legLength = Math.max(legLength, 35) * resolution; // Minimum distance to get outside the cluster icon.\n\n  for (let i = 0; i < count; ++i) {\n    // Clockwise, like spiral.\n    angle = circleStartAngle + i * angleStep;\n    res.push([\n      clusterCenter[0] + legLength * Math.cos(angle),\n      clusterCenter[1] + legLength * Math.sin(angle),\n    ]);\n  }\n\n  return res;\n}\n\nlet hoverFeature;\n/**\n * Style for convex hulls of clusters, activated on hover.\n * @param {Feature} cluster The cluster feature.\n * @return {Style} Polygon style for the convex hull of the cluster.\n */\nfunction clusterHullStyle(cluster) {\n  if (cluster !== hoverFeature) {\n    return;\n  }\n  const originalFeatures = cluster.get('features');\n  const points = originalFeatures.map((feature) =>\n    feature.getGeometry().getCoordinates()\n  );\n  return new Style({\n    geometry: new Polygon([monotoneChainConvexHull(points)]),\n    fill: convexHullFill,\n    stroke: convexHullStroke,\n  });\n}\n\nfunction clusterStyle(feature) {\n  const size = feature.get('features').length;\n  if (size > 1) {\n    return [\n      new Style({\n        image: outerCircle,\n      }),\n      new Style({\n        image: innerCircle,\n        text: new Text({\n          text: size.toString(),\n          fill: textFill,\n          stroke: textStroke,\n        }),\n      }),\n    ];\n  } else {\n    const originalFeature = feature.get('features')[0];\n    return clusterMemberStyle(originalFeature);\n  }\n}\n\nconst vectorSource = new VectorSource({\n  format: new GeoJSON(),\n  url: 'data/geojson/photovoltaic.json',\n});\n\nconst clusterSource = new Cluster({\n  attributions:\n    'Data: <a href=\"https://www.data.gv.at/auftritte/?organisation=stadt-wien\">Stadt Wien</a>',\n  distance: 35,\n  source: vectorSource,\n});\n\n// Layer displaying the convex hull of the hovered cluster.\nconst clusterHulls = new VectorLayer({\n  source: clusterSource,\n  style: clusterHullStyle,\n});\n\n// Layer displaying the clusters and individual features.\nconst clusters = new VectorLayer({\n  source: clusterSource,\n  style: clusterStyle,\n});\n\n// Layer displaying the expanded view of overlapping cluster members.\nconst clusterCircles = new VectorLayer({\n  source: clusterSource,\n  style: clusterCircleStyle,\n});\n\nconst raster = new TileLayer({\n  source: new XYZ({\n    attributions:\n      'Base map: <a target=\"_blank\" href=\"https://basemap.at/\">basemap.at</a>',\n    url: 'https://maps{1-4}.wien.gv.at/basemap/bmapgrau/normal/google3857/{z}/{y}/{x}.png',\n  }),\n});\n\nconst map = new Map({\n  layers: [raster, clusterHulls, clusters, clusterCircles],\n  target: 'map',\n  view: new View({\n    center: [0, 0],\n    zoom: 2,\n    maxZoom: 19,\n    extent: [\n      ...fromLonLat([16.1793, 48.1124]),\n      ...fromLonLat([16.5559, 48.313]),\n    ],\n    showFullExtent: true,\n  }),\n});\n\nmap.on('pointermove', (event) => {\n  clusters.getFeatures(event.pixel).then((features) => {\n    if (features[0] !== hoverFeature) {\n      // Display the convex hull on hover.\n      hoverFeature = features[0];\n      clusterHulls.setStyle(clusterHullStyle);\n      // Change the cursor style to indicate that the cluster is clickable.\n      map.getTargetElement().style.cursor =\n        hoverFeature && hoverFeature.get('features').length > 1\n          ? 'pointer'\n          : '';\n    }\n  });\n});\n\nmap.on('click', (event) => {\n  clusters.getFeatures(event.pixel).then((features) => {\n    if (features.length > 0) {\n      const clusterMembers = features[0].get('features');\n      if (clusterMembers.length > 1) {\n        // Calculate the extent of the cluster members.\n        const extent = createEmpty();\n        clusterMembers.forEach((feature) =>\n          extend(extent, feature.getGeometry().getExtent())\n        );\n        const view = map.getView();\n        const resolution = map.getView().getResolution();\n        if (\n          view.getZoom() === view.getMaxZoom() ||\n          (getWidth(extent) < resolution && getWidth(extent) < resolution)\n        ) {\n          // Show an expanded view of the cluster members.\n          clickFeature = features[0];\n          clickResolution = resolution;\n          clusterCircles.setStyle(clusterCircleStyle);\n        } else {\n          // Zoom to the extent of the cluster members.\n          view.fit(extent, {duration: 500, padding: [50, 50, 50, 50]});\n        }\n      }\n    }\n  });\n});\n"],"names":["clickFeature","clickResolution","hoverFeature","circleStartAngle","Math","PI","convexHullFill","Fill","color","convexHullStroke","Stroke","width","outerCircleFill","innerCircleFill","textFill","textStroke","innerCircle","CircleStyle","radius","fill","outerCircle","darkIcon","Icon","src","lightIcon","clusterMemberStyle","clusterMember","Style","geometry","getGeometry","image","get","clusterCircleStyle","cluster","resolution","clusterMembers","centerCoordinates","getCoordinates","count","clusterCenter","angle","legLength","circleDistanceMultiplier","angleStep","res","max","i","push","cos","sin","generatePointsCircle","length","reduce","styles","coordinates","point","Point","line","LineString","unshift","stroke","Feature","getProperties","clusterHullStyle","points","map","feature","Polygon","monotoneChainConvexHull","vectorSource","VectorSource","format","GeoJSON","url","clusterSource","Cluster","attributions","distance","source","clusterHulls","VectorLayer","style","clusters","size","text","Text","toString","clusterCircles","raster","TileLayer","XYZ","Map","layers","target","view","View","center","zoom","maxZoom","extent","fromLonLat","showFullExtent","on","event","getFeatures","pixel","then","features","setStyle","getTargetElement","cursor","createEmpty","forEach","extend","getExtent","getView","getResolution","getZoom","getMaxZoom","getWidth","fit","duration","padding"],"sourceRoot":""}