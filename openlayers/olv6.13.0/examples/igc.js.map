{"version":3,"file":"igc.js","mappings":"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","sources":["webpack:///./igc.js"],"sourcesContent":["import Feature from '../src/ol/Feature.js';\nimport IGC from '../src/ol/format/IGC.js';\nimport Map from '../src/ol/Map.js';\nimport OSM, {ATTRIBUTION} from '../src/ol/source/OSM.js';\nimport VectorSource from '../src/ol/source/Vector.js';\nimport View from '../src/ol/View.js';\nimport {Circle as CircleStyle, Fill, Stroke, Style} from '../src/ol/style.js';\nimport {LineString, Point} from '../src/ol/geom.js';\nimport {Tile as TileLayer, Vector as VectorLayer} from '../src/ol/layer.js';\nimport {getVectorContext} from '../src/ol/render.js';\n\nconst colors = {\n  'Clement Latour': 'rgba(0, 0, 255, 0.7)',\n  'Damien de Baesnt': 'rgba(0, 215, 255, 0.7)',\n  'Sylvain Dhonneur': 'rgba(0, 165, 255, 0.7)',\n  'Tom Payne': 'rgba(0, 255, 255, 0.7)',\n  'Ulrich Prinz': 'rgba(0, 215, 255, 0.7)',\n};\n\nconst styleCache = {};\nconst styleFunction = function (feature) {\n  const color = colors[feature.get('PLT')];\n  let style = styleCache[color];\n  if (!style) {\n    style = new Style({\n      stroke: new Stroke({\n        color: color,\n        width: 3,\n      }),\n    });\n    styleCache[color] = style;\n  }\n  return style;\n};\n\nconst vectorSource = new VectorSource();\n\nconst igcUrls = [\n  'data/igc/Clement-Latour.igc',\n  'data/igc/Damien-de-Baenst.igc',\n  'data/igc/Sylvain-Dhonneur.igc',\n  'data/igc/Tom-Payne.igc',\n  'data/igc/Ulrich-Prinz.igc',\n];\n\nfunction get(url, callback) {\n  const client = new XMLHttpRequest();\n  client.open('GET', url);\n  client.onload = function () {\n    callback(client.responseText);\n  };\n  client.send();\n}\n\nconst igcFormat = new IGC();\nfor (let i = 0; i < igcUrls.length; ++i) {\n  get(igcUrls[i], function (data) {\n    const features = igcFormat.readFeatures(data, {\n      featureProjection: 'EPSG:3857',\n    });\n    vectorSource.addFeatures(features);\n  });\n}\n\nconst time = {\n  start: Infinity,\n  stop: -Infinity,\n  duration: 0,\n};\nvectorSource.on('addfeature', function (event) {\n  const geometry = event.feature.getGeometry();\n  time.start = Math.min(time.start, geometry.getFirstCoordinate()[2]);\n  time.stop = Math.max(time.stop, geometry.getLastCoordinate()[2]);\n  time.duration = time.stop - time.start;\n});\n\nconst vectorLayer = new VectorLayer({\n  source: vectorSource,\n  style: styleFunction,\n});\n\nconst map = new Map({\n  layers: [\n    new TileLayer({\n      source: new OSM({\n        attributions: [\n          'All maps Â© <a href=\"https://www.opencyclemap.org/\">OpenCycleMap</a>',\n          ATTRIBUTION,\n        ],\n        url:\n          'https://{a-c}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png' +\n          '?apikey=0e6fc415256d4fbb9b5166a718591d71',\n      }),\n    }),\n    vectorLayer,\n  ],\n  target: 'map',\n  view: new View({\n    center: [703365.7089403362, 5714629.865071137],\n    zoom: 9,\n  }),\n});\n\nlet point = null;\nlet line = null;\nconst displaySnap = function (coordinate) {\n  const closestFeature = vectorSource.getClosestFeatureToCoordinate(coordinate);\n  const info = document.getElementById('info');\n  if (closestFeature === null) {\n    point = null;\n    line = null;\n    info.innerHTML = '&nbsp;';\n  } else {\n    const geometry = closestFeature.getGeometry();\n    const closestPoint = geometry.getClosestPoint(coordinate);\n    if (point === null) {\n      point = new Point(closestPoint);\n    } else {\n      point.setCoordinates(closestPoint);\n    }\n    const date = new Date(closestPoint[2] * 1000);\n    info.innerHTML =\n      closestFeature.get('PLT') + ' (' + date.toUTCString() + ')';\n    const coordinates = [coordinate, [closestPoint[0], closestPoint[1]]];\n    if (line === null) {\n      line = new LineString(coordinates);\n    } else {\n      line.setCoordinates(coordinates);\n    }\n  }\n  map.render();\n};\n\nmap.on('pointermove', function (evt) {\n  if (evt.dragging) {\n    return;\n  }\n  const coordinate = map.getEventCoordinate(evt.originalEvent);\n  displaySnap(coordinate);\n});\n\nmap.on('click', function (evt) {\n  displaySnap(evt.coordinate);\n});\n\nconst stroke = new Stroke({\n  color: 'rgba(255,0,0,0.9)',\n  width: 1,\n});\nconst style = new Style({\n  stroke: stroke,\n  image: new CircleStyle({\n    radius: 5,\n    fill: null,\n    stroke: stroke,\n  }),\n});\nvectorLayer.on('postrender', function (evt) {\n  const vectorContext = getVectorContext(evt);\n  vectorContext.setStyle(style);\n  if (point !== null) {\n    vectorContext.drawGeometry(point);\n  }\n  if (line !== null) {\n    vectorContext.drawGeometry(line);\n  }\n});\n\nconst featureOverlay = new VectorLayer({\n  source: new VectorSource(),\n  map: map,\n  style: new Style({\n    image: new CircleStyle({\n      radius: 5,\n      fill: new Fill({\n        color: 'rgba(255,0,0,0.9)',\n      }),\n    }),\n  }),\n});\n\nconst control = document.getElementById('time');\nconst listener = function () {\n  const value = parseInt(control.value, 10) / 100;\n  const m = time.start + time.duration * value;\n  vectorSource.forEachFeature(function (feature) {\n    const geometry =\n      /** @type {import(\"../src/ol/geom/LineString.js\").default} */ (\n        feature.getGeometry()\n      );\n    const coordinate = geometry.getCoordinateAtM(m, true);\n    let highlight = feature.get('highlight');\n    if (highlight === undefined) {\n      highlight = new Feature(new Point(coordinate));\n      feature.set('highlight', highlight);\n      featureOverlay.getSource().addFeature(highlight);\n    } else {\n      highlight.getGeometry().setCoordinates(coordinate);\n    }\n  });\n  map.render();\n};\ncontrol.addEventListener('input', listener);\ncontrol.addEventListener('change', listener);\n"],"names":["colors","styleCache","vectorSource","VectorSource","igcUrls","get","url","callback","client","XMLHttpRequest","open","onload","responseText","send","igcFormat","IGC","i","length","data","features","readFeatures","featureProjection","addFeatures","time","start","Infinity","stop","duration","on","event","geometry","feature","getGeometry","Math","min","getFirstCoordinate","max","getLastCoordinate","vectorLayer","VectorLayer","source","style","color","Style","stroke","Stroke","width","map","Map","layers","TileLayer","OSM","attributions","ATTRIBUTION","target","view","View","center","zoom","point","line","displaySnap","coordinate","closestFeature","getClosestFeatureToCoordinate","info","document","getElementById","innerHTML","closestPoint","getClosestPoint","Point","setCoordinates","date","Date","toUTCString","coordinates","LineString","render","evt","dragging","getEventCoordinate","originalEvent","image","CircleStyle","radius","fill","vectorContext","getVectorContext","setStyle","drawGeometry","featureOverlay","Fill","control","listener","value","parseInt","m","forEachFeature","getCoordinateAtM","highlight","undefined","Feature","set","getSource","addFeature","addEventListener"],"sourceRoot":""}