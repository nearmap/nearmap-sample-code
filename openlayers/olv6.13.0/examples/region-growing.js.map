{"version":3,"file":"region-growing.js","mappings":"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","sources":["webpack:///./region-growing.js"],"sourcesContent":["import Map from '../src/ol/Map.js';\nimport RasterSource from '../src/ol/source/Raster.js';\nimport View from '../src/ol/View.js';\nimport XYZ from '../src/ol/source/XYZ.js';\nimport {Image as ImageLayer, Tile as TileLayer} from '../src/ol/layer.js';\nimport {fromLonLat} from '../src/ol/proj.js';\n\nfunction growRegion(inputs, data) {\n  const image = inputs[0];\n  let seed = data.pixel;\n  const delta = parseInt(data.delta);\n  if (!seed) {\n    return image;\n  }\n\n  seed = seed.map(Math.round);\n  const width = image.width;\n  const height = image.height;\n  const inputData = image.data;\n  const outputData = new Uint8ClampedArray(inputData);\n  const seedIdx = (seed[1] * width + seed[0]) * 4;\n  const seedR = inputData[seedIdx];\n  const seedG = inputData[seedIdx + 1];\n  const seedB = inputData[seedIdx + 2];\n  let edge = [seed];\n  while (edge.length) {\n    const newedge = [];\n    for (let i = 0, ii = edge.length; i < ii; i++) {\n      // As noted in the Raster source constructor, this function is provided\n      // using the `lib` option. Other functions will NOT be visible unless\n      // provided using the `lib` option.\n      const next = next4Edges(edge[i]);\n      for (let j = 0, jj = next.length; j < jj; j++) {\n        const s = next[j][0];\n        const t = next[j][1];\n        if (s >= 0 && s < width && t >= 0 && t < height) {\n          const ci = (t * width + s) * 4;\n          const cr = inputData[ci];\n          const cg = inputData[ci + 1];\n          const cb = inputData[ci + 2];\n          const ca = inputData[ci + 3];\n          // if alpha is zero, carry on\n          if (ca === 0) {\n            continue;\n          }\n          if (\n            Math.abs(seedR - cr) < delta &&\n            Math.abs(seedG - cg) < delta &&\n            Math.abs(seedB - cb) < delta\n          ) {\n            outputData[ci] = 255;\n            outputData[ci + 1] = 0;\n            outputData[ci + 2] = 0;\n            outputData[ci + 3] = 255;\n            newedge.push([s, t]);\n          }\n          // mark as visited\n          inputData[ci + 3] = 0;\n        }\n      }\n    }\n    edge = newedge;\n  }\n  return {data: outputData, width: width, height: height};\n}\n\nfunction next4Edges(edge) {\n  const x = edge[0];\n  const y = edge[1];\n  return [\n    [x + 1, y],\n    [x - 1, y],\n    [x, y + 1],\n    [x, y - 1],\n  ];\n}\n\nconst key = 'get_your_own_D6rA4zTHduk6KOKTXzGB';\nconst attributions =\n  '<a href=\"https://www.maptiler.com/copyright/\" target=\"_blank\">&copy; MapTiler</a> ' +\n  '<a href=\"https://www.openstreetmap.org/copyright\" target=\"_blank\">&copy; OpenStreetMap contributors</a>';\n\nconst imagery = new TileLayer({\n  source: new XYZ({\n    attributions: attributions,\n    url: 'https://api.maptiler.com/tiles/satellite/{z}/{x}/{y}.jpg?key=' + key,\n    maxZoom: 20,\n    crossOrigin: '',\n  }),\n});\n\nconst raster = new RasterSource({\n  sources: [imagery.getSource()],\n  operationType: 'image',\n  operation: growRegion,\n  // Functions in the `lib` object will be available to the operation run in\n  // the web worker.\n  lib: {\n    next4Edges: next4Edges,\n  },\n});\n\nconst rasterImage = new ImageLayer({\n  opacity: 0.7,\n  source: raster,\n});\n\nconst map = new Map({\n  layers: [imagery, rasterImage],\n  target: 'map',\n  view: new View({\n    center: fromLonLat([-119.07, 47.65]),\n    zoom: 11,\n  }),\n});\n\nlet coordinate;\n\nmap.on('click', function (event) {\n  coordinate = event.coordinate;\n  raster.changed();\n});\n\nconst thresholdControl = document.getElementById('threshold');\n\nraster.on('beforeoperations', function (event) {\n  // the event.data object will be passed to operations\n  const data = event.data;\n  data.delta = thresholdControl.value;\n  if (coordinate) {\n    data.pixel = map.getPixelFromCoordinate(coordinate);\n  }\n});\n\nfunction updateControlValue() {\n  document.getElementById('threshold-value').innerText = thresholdControl.value;\n}\nupdateControlValue();\n\nconst listener = function () {\n  updateControlValue();\n  raster.changed();\n};\nthresholdControl.addEventListener('input', listener);\nthresholdControl.addEventListener('change', listener);\n"],"names":["Map","RasterSource","View","XYZ","Image","ImageLayer","Tile","TileLayer","fromLonLat","growRegion","inputs","data","image","seed","pixel","delta","parseInt","map","Math","round","width","height","inputData","outputData","Uint8ClampedArray","seedIdx","seedR","seedG","seedB","edge","length","newedge","i","ii","next","next4Edges","j","jj","s","t","ci","cr","cg","cb","ca","abs","push","x","y","key","attributions","imagery","source","url","maxZoom","crossOrigin","raster","sources","getSource","operationType","operation","lib","rasterImage","opacity","layers","target","view","center","zoom","coordinate","on","event","changed","thresholdControl","document","getElementById","value","getPixelFromCoordinate","updateControlValue","innerText","listener","addEventListener"],"sourceRoot":""}