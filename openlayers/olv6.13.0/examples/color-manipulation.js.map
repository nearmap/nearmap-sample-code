{"version":3,"file":"color-manipulation.js","mappings":";;;;;;;;;;;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;AACA,IAAMM,EAAE,GAAG,OAAX;AACA,IAAMC,EAAE,GAAG,CAAX;AACA,IAAMC,EAAE,GAAG,OAAX;AACA,IAAMC,EAAE,GAAG,IAAI,EAAf;AACA,IAAMC,EAAE,GAAG,IAAI,EAAf;AACA,IAAMC,EAAE,GAAG,IAAID,EAAJ,GAASA,EAApB;AACA,IAAME,EAAE,GAAGF,EAAE,GAAGA,EAAL,GAAUA,EAArB;AACA,IAAMG,KAAK,GAAG,IAAIC,IAAI,CAACC,EAAvB;AAEA;AACA;AACA;AACA;AACA;;AACA,SAASC,OAAT,CAAiBC,KAAjB,EAAwB;AACtB,MAAMC,GAAG,GAAGC,OAAO,CAACF,KAAK,CAAC,CAAD,CAAN,CAAnB;AACA,MAAMG,KAAK,GAAGD,OAAO,CAACF,KAAK,CAAC,CAAD,CAAN,CAArB;AACA,MAAMI,IAAI,GAAGF,OAAO,CAACF,KAAK,CAAC,CAAD,CAAN,CAApB;AAEA,MAAMK,CAAC,GAAGC,OAAO,CACf,CAAC,YAAYL,GAAZ,GAAkB,YAAYE,KAA9B,GAAsC,YAAYC,IAAnD,IAA2Df,EAD5C,CAAjB;AAGA,MAAMkB,CAAC,GAAGD,OAAO,CACf,CAAC,YAAYL,GAAZ,GAAkB,YAAYE,KAA9B,GAAsC,WAAWC,IAAlD,IAA0Dd,EAD3C,CAAjB;AAGA,MAAMkB,CAAC,GAAGF,OAAO,CACf,CAAC,YAAYL,GAAZ,GAAkB,WAAWE,KAA7B,GAAqC,YAAYC,IAAlD,IAA0Db,EAD3C,CAAjB;AAIA,MAAMkB,CAAC,GAAG,MAAMF,CAAN,GAAU,EAApB;AACA,MAAMG,CAAC,GAAG,OAAOL,CAAC,GAAGE,CAAX,CAAV;AACA,MAAMI,CAAC,GAAG,OAAOJ,CAAC,GAAGC,CAAX,CAAV;AAEA,MAAMI,CAAC,GAAGf,IAAI,CAACgB,IAAL,CAAUH,CAAC,GAAGA,CAAJ,GAAQC,CAAC,GAAGA,CAAtB,CAAV;AACA,MAAIG,CAAC,GAAGjB,IAAI,CAACkB,KAAL,CAAWJ,CAAX,EAAcD,CAAd,CAAR;;AACA,MAAII,CAAC,GAAG,CAAR,EAAW;AACTA,IAAAA,CAAC,IAAIlB,KAAL;AACD;;AAEDI,EAAAA,KAAK,CAAC,CAAD,CAAL,GAAWc,CAAX;AACAd,EAAAA,KAAK,CAAC,CAAD,CAAL,GAAWY,CAAX;AACAZ,EAAAA,KAAK,CAAC,CAAD,CAAL,GAAWS,CAAX;AAEA,SAAOT,KAAP;AACD;AAED;AACA;AACA;AACA;AACA;;;AACA,SAASgB,OAAT,CAAiBhB,KAAjB,EAAwB;AACtB,MAAMc,CAAC,GAAGd,KAAK,CAAC,CAAD,CAAf;AACA,MAAMY,CAAC,GAAGZ,KAAK,CAAC,CAAD,CAAf;AACA,MAAMS,CAAC,GAAGT,KAAK,CAAC,CAAD,CAAf;AAEA,MAAMU,CAAC,GAAGb,IAAI,CAACoB,GAAL,CAASH,CAAT,IAAcF,CAAxB;AACA,MAAMD,CAAC,GAAGd,IAAI,CAACqB,GAAL,CAASJ,CAAT,IAAcF,CAAxB;AAEA,MAAIL,CAAC,GAAG,CAACE,CAAC,GAAG,EAAL,IAAW,GAAnB;AACA,MAAIJ,CAAC,GAAGc,KAAK,CAACT,CAAD,CAAL,GAAWH,CAAX,GAAeA,CAAC,GAAGG,CAAC,GAAG,GAA/B;AACA,MAAIF,CAAC,GAAGW,KAAK,CAACR,CAAD,CAAL,GAAWJ,CAAX,GAAeA,CAAC,GAAGI,CAAC,GAAG,GAA/B;AAEAJ,EAAAA,CAAC,GAAGjB,EAAE,GAAG8B,OAAO,CAACb,CAAD,CAAhB;AACAF,EAAAA,CAAC,GAAGhB,EAAE,GAAG+B,OAAO,CAACf,CAAD,CAAhB;AACAG,EAAAA,CAAC,GAAGjB,EAAE,GAAG6B,OAAO,CAACZ,CAAD,CAAhB;AAEAR,EAAAA,KAAK,CAAC,CAAD,CAAL,GAAWqB,OAAO,CAAC,YAAYhB,CAAZ,GAAgB,YAAYE,CAA5B,GAAgC,YAAYC,CAA7C,CAAlB;AACAR,EAAAA,KAAK,CAAC,CAAD,CAAL,GAAWqB,OAAO,CAAC,CAAC,QAAD,GAAYhB,CAAZ,GAAgB,YAAYE,CAA5B,GAAgC,WAAWC,CAA5C,CAAlB;AACAR,EAAAA,KAAK,CAAC,CAAD,CAAL,GAAWqB,OAAO,CAAC,YAAYhB,CAAZ,GAAgB,YAAYE,CAA5B,GAAgC,YAAYC,CAA7C,CAAlB;AAEA,SAAOR,KAAP;AACD;;AAED,SAASM,OAAT,CAAiBgB,CAAjB,EAAoB;AAClB,SAAOA,CAAC,GAAG3B,EAAJ,GAASE,IAAI,CAAC0B,GAAL,CAASD,CAAT,EAAY,IAAI,CAAhB,CAAT,GAA8BA,CAAC,GAAG5B,EAAJ,GAASF,EAA9C;AACD;;AAED,SAAS4B,OAAT,CAAiBE,CAAjB,EAAoB;AAClB,SAAOA,CAAC,GAAG7B,EAAJ,GAAS6B,CAAC,GAAGA,CAAJ,GAAQA,CAAjB,GAAqB5B,EAAE,IAAI4B,CAAC,GAAG9B,EAAR,CAA9B;AACD;;AAED,SAASU,OAAT,CAAiBG,CAAjB,EAAoB;AAClB,SAAO,CAACA,CAAC,IAAI,GAAN,KAAc,OAAd,GAAwBA,CAAC,GAAG,KAA5B,GAAoCR,IAAI,CAAC0B,GAAL,CAAS,CAAClB,CAAC,GAAG,KAAL,IAAc,KAAvB,EAA8B,GAA9B,CAA3C;AACD;;AAED,SAASgB,OAAT,CAAiBhB,CAAjB,EAAoB;AAClB,SACE,OAAOA,CAAC,IAAI,SAAL,GAAiB,QAAQA,CAAzB,GAA6B,QAAQR,IAAI,CAAC0B,GAAL,CAASlB,CAAT,EAAY,IAAI,GAAhB,CAAR,GAA+B,KAAnE,CADF;AAGD;;AAED,IAAMmB,MAAM,GAAG,IAAIrC,mEAAJ,CAAiB;AAC9BsC,EAAAA,OAAO,EAAE,CACP,IAAIrC,kEAAJ,CAAW;AACTsC,IAAAA,KAAK,EAAE;AADE,GAAX,CADO,CADqB;AAM9BC,EAAAA,SAAS,EAAE,mBAAUC,MAAV,EAAkBC,IAAlB,EAAwB;AACjC,QAAMC,GAAG,GAAG/B,OAAO,CAAC6B,MAAM,CAAC,CAAD,CAAP,CAAnB;AAEA,QAAId,CAAC,GAAGgB,GAAG,CAAC,CAAD,CAAH,GAAUjC,IAAI,CAACC,EAAL,GAAU+B,IAAI,CAACE,GAAhB,GAAuB,GAAxC;;AACA,QAAIjB,CAAC,GAAG,CAAR,EAAW;AACTA,MAAAA,CAAC,IAAIlB,KAAL;AACD,KAFD,MAEO,IAAIkB,CAAC,GAAGlB,KAAR,EAAe;AACpBkB,MAAAA,CAAC,IAAIlB,KAAL;AACD;;AACDkC,IAAAA,GAAG,CAAC,CAAD,CAAH,GAAShB,CAAT;AAEAgB,IAAAA,GAAG,CAAC,CAAD,CAAH,IAAUD,IAAI,CAACG,MAAL,GAAc,GAAxB;AACAF,IAAAA,GAAG,CAAC,CAAD,CAAH,IAAUD,IAAI,CAACI,SAAL,GAAiB,GAA3B;AAEA,WAAOjB,OAAO,CAACc,GAAD,CAAd;AACD,GArB6B;AAsB9BI,EAAAA,GAAG,EAAE;AACHnC,IAAAA,OAAO,EAAEA,OADN;AAEHiB,IAAAA,OAAO,EAAEA,OAFN;AAGHd,IAAAA,OAAO,EAAEA,OAHN;AAIHkB,IAAAA,OAAO,EAAEA,OAJN;AAKHd,IAAAA,OAAO,EAAEA,OALN;AAMHe,IAAAA,OAAO,EAAEA,OANN;AAOHhC,IAAAA,EAAE,EAAEA,EAPD;AAQHC,IAAAA,EAAE,EAAEA,EARD;AASHC,IAAAA,EAAE,EAAEA,EATD;AAUHC,IAAAA,EAAE,EAAEA,EAVD;AAWHC,IAAAA,EAAE,EAAEA,EAXD;AAYHC,IAAAA,EAAE,EAAEA,EAZD;AAaHC,IAAAA,EAAE,EAAEA,EAbD;AAcHC,IAAAA,KAAK,EAAEA;AAdJ;AAtByB,CAAjB,CAAf;AAwCA,IAAMuC,QAAQ,GAAG,EAAjB;AAEAX,MAAM,CAACY,EAAP,CAAU,kBAAV,EAA8B,UAAUC,KAAV,EAAiB;AAC7C,MAAMR,IAAI,GAAGQ,KAAK,CAACR,IAAnB;;AACA,OAAK,IAAMS,EAAX,IAAiBH,QAAjB,EAA2B;AACzBN,IAAAA,IAAI,CAACS,EAAD,CAAJ,GAAWC,MAAM,CAACJ,QAAQ,CAACG,EAAD,CAAR,CAAaE,KAAd,CAAjB;AACD;AACF,CALD;AAOA,IAAMC,GAAG,GAAG,IAAIzD,+DAAJ,CAAQ;AAClB0D,EAAAA,MAAM,EAAE,CACN,IAAI3D,uEAAJ,CAAe;AACb4D,IAAAA,MAAM,EAAEnB;AADK,GAAf,CADM,CADU;AAMlBoB,EAAAA,MAAM,EAAE,KANU;AAOlBC,EAAAA,IAAI,EAAE,IAAI5D,iEAAJ,CAAS;AACb6D,IAAAA,MAAM,EAAE,CAAC,CAAD,EAAI,OAAJ,CADK;AAEbC,IAAAA,IAAI,EAAE,CAFO;AAGbC,IAAAA,OAAO,EAAE;AAHI,GAAT;AAPY,CAAR,CAAZ;AAcA,IAAMC,UAAU,GAAG,CAAC,KAAD,EAAQ,QAAR,EAAkB,WAAlB,CAAnB;AACAA,UAAU,CAACC,OAAX,CAAmB,UAAUZ,EAAV,EAAc;AAC/B,MAAMa,OAAO,GAAGC,QAAQ,CAACC,cAAT,CAAwBf,EAAxB,CAAhB;AACA,MAAMgB,MAAM,GAAGF,QAAQ,CAACC,cAAT,CAAwBf,EAAE,GAAG,KAA7B,CAAf;;AACA,MAAMiB,QAAQ,GAAG,SAAXA,QAAW,GAAY;AAC3BD,IAAAA,MAAM,CAACE,SAAP,GAAmBL,OAAO,CAACX,KAA3B;AACAhB,IAAAA,MAAM,CAACiC,OAAP;AACD,GAHD;;AAIAN,EAAAA,OAAO,CAACO,gBAAR,CAAyB,OAAzB,EAAkCH,QAAlC;AACAJ,EAAAA,OAAO,CAACO,gBAAR,CAAyB,QAAzB,EAAmCH,QAAnC;AACAD,EAAAA,MAAM,CAACE,SAAP,GAAmBL,OAAO,CAACX,KAA3B;AACAL,EAAAA,QAAQ,CAACG,EAAD,CAAR,GAAea,OAAf;AACD,CAXD","sources":["webpack:///./color-manipulation.js"],"sourcesContent":["import ImageLayer from '../src/ol/layer/Image.js';\nimport Map from '../src/ol/Map.js';\nimport View from '../src/ol/View.js';\nimport {Raster as RasterSource, Stamen} from '../src/ol/source.js';\n\n/**\n * Color manipulation functions below are adapted from\n * https://github.com/d3/d3-color.\n */\nconst Xn = 0.95047;\nconst Yn = 1;\nconst Zn = 1.08883;\nconst t0 = 4 / 29;\nconst t1 = 6 / 29;\nconst t2 = 3 * t1 * t1;\nconst t3 = t1 * t1 * t1;\nconst twoPi = 2 * Math.PI;\n\n/**\n * Convert an RGB pixel into an HCL pixel.\n * @param {Array<number>} pixel A pixel in RGB space.\n * @return {Array<number>} A pixel in HCL space.\n */\nfunction rgb2hcl(pixel) {\n  const red = rgb2xyz(pixel[0]);\n  const green = rgb2xyz(pixel[1]);\n  const blue = rgb2xyz(pixel[2]);\n\n  const x = xyz2lab(\n    (0.4124564 * red + 0.3575761 * green + 0.1804375 * blue) / Xn\n  );\n  const y = xyz2lab(\n    (0.2126729 * red + 0.7151522 * green + 0.072175 * blue) / Yn\n  );\n  const z = xyz2lab(\n    (0.0193339 * red + 0.119192 * green + 0.9503041 * blue) / Zn\n  );\n\n  const l = 116 * y - 16;\n  const a = 500 * (x - y);\n  const b = 200 * (y - z);\n\n  const c = Math.sqrt(a * a + b * b);\n  let h = Math.atan2(b, a);\n  if (h < 0) {\n    h += twoPi;\n  }\n\n  pixel[0] = h;\n  pixel[1] = c;\n  pixel[2] = l;\n\n  return pixel;\n}\n\n/**\n * Convert an HCL pixel into an RGB pixel.\n * @param {Array<number>} pixel A pixel in HCL space.\n * @return {Array<number>} A pixel in RGB space.\n */\nfunction hcl2rgb(pixel) {\n  const h = pixel[0];\n  const c = pixel[1];\n  const l = pixel[2];\n\n  const a = Math.cos(h) * c;\n  const b = Math.sin(h) * c;\n\n  let y = (l + 16) / 116;\n  let x = isNaN(a) ? y : y + a / 500;\n  let z = isNaN(b) ? y : y - b / 200;\n\n  y = Yn * lab2xyz(y);\n  x = Xn * lab2xyz(x);\n  z = Zn * lab2xyz(z);\n\n  pixel[0] = xyz2rgb(3.2404542 * x - 1.5371385 * y - 0.4985314 * z);\n  pixel[1] = xyz2rgb(-0.969266 * x + 1.8760108 * y + 0.041556 * z);\n  pixel[2] = xyz2rgb(0.0556434 * x - 0.2040259 * y + 1.0572252 * z);\n\n  return pixel;\n}\n\nfunction xyz2lab(t) {\n  return t > t3 ? Math.pow(t, 1 / 3) : t / t2 + t0;\n}\n\nfunction lab2xyz(t) {\n  return t > t1 ? t * t * t : t2 * (t - t0);\n}\n\nfunction rgb2xyz(x) {\n  return (x /= 255) <= 0.04045 ? x / 12.92 : Math.pow((x + 0.055) / 1.055, 2.4);\n}\n\nfunction xyz2rgb(x) {\n  return (\n    255 * (x <= 0.0031308 ? 12.92 * x : 1.055 * Math.pow(x, 1 / 2.4) - 0.055)\n  );\n}\n\nconst raster = new RasterSource({\n  sources: [\n    new Stamen({\n      layer: 'watercolor',\n    }),\n  ],\n  operation: function (pixels, data) {\n    const hcl = rgb2hcl(pixels[0]);\n\n    let h = hcl[0] + (Math.PI * data.hue) / 180;\n    if (h < 0) {\n      h += twoPi;\n    } else if (h > twoPi) {\n      h -= twoPi;\n    }\n    hcl[0] = h;\n\n    hcl[1] *= data.chroma / 100;\n    hcl[2] *= data.lightness / 100;\n\n    return hcl2rgb(hcl);\n  },\n  lib: {\n    rgb2hcl: rgb2hcl,\n    hcl2rgb: hcl2rgb,\n    rgb2xyz: rgb2xyz,\n    lab2xyz: lab2xyz,\n    xyz2lab: xyz2lab,\n    xyz2rgb: xyz2rgb,\n    Xn: Xn,\n    Yn: Yn,\n    Zn: Zn,\n    t0: t0,\n    t1: t1,\n    t2: t2,\n    t3: t3,\n    twoPi: twoPi,\n  },\n});\n\nconst controls = {};\n\nraster.on('beforeoperations', function (event) {\n  const data = event.data;\n  for (const id in controls) {\n    data[id] = Number(controls[id].value);\n  }\n});\n\nconst map = new Map({\n  layers: [\n    new ImageLayer({\n      source: raster,\n    }),\n  ],\n  target: 'map',\n  view: new View({\n    center: [0, 2500000],\n    zoom: 2,\n    maxZoom: 18,\n  }),\n});\n\nconst controlIds = ['hue', 'chroma', 'lightness'];\ncontrolIds.forEach(function (id) {\n  const control = document.getElementById(id);\n  const output = document.getElementById(id + 'Out');\n  const listener = function () {\n    output.innerText = control.value;\n    raster.changed();\n  };\n  control.addEventListener('input', listener);\n  control.addEventListener('change', listener);\n  output.innerText = control.value;\n  controls[id] = control;\n});\n"],"names":["ImageLayer","Map","View","Raster","RasterSource","Stamen","Xn","Yn","Zn","t0","t1","t2","t3","twoPi","Math","PI","rgb2hcl","pixel","red","rgb2xyz","green","blue","x","xyz2lab","y","z","l","a","b","c","sqrt","h","atan2","hcl2rgb","cos","sin","isNaN","lab2xyz","xyz2rgb","t","pow","raster","sources","layer","operation","pixels","data","hcl","hue","chroma","lightness","lib","controls","on","event","id","Number","value","map","layers","source","target","view","center","zoom","maxZoom","controlIds","forEach","control","document","getElementById","output","listener","innerText","changed","addEventListener"],"sourceRoot":""}