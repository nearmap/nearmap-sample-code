{"version":3,"file":"export-map.js","mappings":"wLAWMA,EAAQ,IAAIC,EAAAA,GAAM,CACtBC,KAAM,IAAIC,EAAAA,EAAK,CACbC,MAAO,cAILC,EAAM,IAAIC,EAAAA,EAAI,CAClBC,OAAQ,CACN,IAAIC,EAAAA,EAAY,CACdC,OAAQ,IAAIC,EAAAA,EAAa,CACvBC,IAAK,qDACLC,OAAQ,IAAIC,EAAAA,IAEdC,WAAY,QACZd,MAAO,SAAUe,GACf,IAAMX,GAAQY,EAAAA,EAAAA,IAAQD,EAAQE,IAAI,cAAgB,WAGlD,OAFAb,EAAM,GAAK,IACXJ,EAAMkB,UAAUC,SAASf,GAClBJ,KAGX,IAAIoB,EAAAA,EAAa,CACfX,OAAQ,IAAIC,EAAAA,EAAa,CACvBC,IAAK,oCACLC,OAAQ,IAAIC,EAAAA,IAEdQ,OAAQ,SAAUN,GAChB,OAAOA,EAAQE,IAAI,cAAgB,KAErCK,OAAQ,GACRC,KAAM,GACNC,QAAS,OAGbC,OAAQ,MACRC,KAAM,IAAIC,EAAAA,GAAK,CACbC,OAAQ,CAAC,EAAG,GACZC,KAAM,MAIVC,SAASC,eAAe,cAAcC,iBAAiB,SAAS,WAC9D3B,EAAI4B,KAAK,kBAAkB,WACzB,IAAMC,EAAYJ,SAASK,cAAc,UACnCC,EAAO/B,EAAIgC,UACjBH,EAAUI,MAAQF,EAAK,GACvBF,EAAUK,OAASH,EAAK,GACxB,IAAMI,EAAaN,EAAUO,WAAW,MA2CxC,GA1CAC,MAAMC,UAAUC,QAAQC,KACtBxC,EAAIyC,cAAcC,iBAAiB,sCACnC,SAAUC,GACR,GAAIA,EAAOV,MAAQ,EAAG,CACpB,IAAMd,EACJwB,EAAOC,WAAWjD,MAAMwB,SAAWwB,EAAOhD,MAAMwB,QAClDgB,EAAWU,YAA0B,KAAZ1B,EAAiB,EAAI2B,OAAO3B,GAErD,IAMI4B,EANEC,EAAkBL,EAAOC,WAAWjD,MAAMqD,gBAC5CA,IACFb,EAAWc,UAAYD,EACvBb,EAAWe,SAAS,EAAG,EAAGP,EAAOV,MAAOU,EAAOT,SAIjD,IAAMiB,EAAYR,EAAOhD,MAAMwD,UAG7BJ,EAFEI,EAEOA,EACNC,MAAM,wBAAwB,GAC9BC,MAAM,KACNrD,IAAI8C,QAEE,CACPQ,WAAWX,EAAOhD,MAAMsC,OAASU,EAAOV,MACxC,EACA,EACAqB,WAAWX,EAAOhD,MAAMuC,QAAUS,EAAOT,OACzC,EACA,GAIJqB,yBAAyBjB,UAAUkB,aAAaC,MAC9CtB,EACAY,GAEFZ,EAAWuB,UAAUf,EAAQ,EAAG,OAItCR,EAAWU,YAAc,EACrBc,UAAUC,WAEZD,UAAUC,WAAW/B,EAAUgC,WAAY,eACtC,CACL,IAAMC,EAAOrC,SAASC,eAAe,kBACrCoC,EAAKC,KAAOlC,EAAUmC,YACtBF,EAAKG,YAGTjE,EAAIkE,kB","sources":["webpack:///./export-map.js"],"sourcesContent":["import GeoJSON from '../src/ol/format/GeoJSON.js';\nimport Map from '../src/ol/Map.js';\nimport VectorSource from '../src/ol/source/Vector.js';\nimport View from '../src/ol/View.js';\nimport {Fill, Style} from '../src/ol/style.js';\nimport {\n  Heatmap as HeatmapLayer,\n  Vector as VectorLayer,\n} from '../src/ol/layer.js';\nimport {asArray} from '../src/ol/color.js';\n\nconst style = new Style({\n  fill: new Fill({\n    color: '#eeeeee',\n  }),\n});\n\nconst map = new Map({\n  layers: [\n    new VectorLayer({\n      source: new VectorSource({\n        url: 'https://openlayers.org/data/vector/ecoregions.json',\n        format: new GeoJSON(),\n      }),\n      background: 'white',\n      style: function (feature) {\n        const color = asArray(feature.get('COLOR_NNH') || '#eeeeee');\n        color[3] = 0.75;\n        style.getFill().setColor(color);\n        return style;\n      },\n    }),\n    new HeatmapLayer({\n      source: new VectorSource({\n        url: 'data/geojson/world-cities.geojson',\n        format: new GeoJSON(),\n      }),\n      weight: function (feature) {\n        return feature.get('population') / 1e7;\n      },\n      radius: 15,\n      blur: 15,\n      opacity: 0.75,\n    }),\n  ],\n  target: 'map',\n  view: new View({\n    center: [0, 0],\n    zoom: 2,\n  }),\n});\n\ndocument.getElementById('export-png').addEventListener('click', function () {\n  map.once('rendercomplete', function () {\n    const mapCanvas = document.createElement('canvas');\n    const size = map.getSize();\n    mapCanvas.width = size[0];\n    mapCanvas.height = size[1];\n    const mapContext = mapCanvas.getContext('2d');\n    Array.prototype.forEach.call(\n      map.getViewport().querySelectorAll('.ol-layer canvas, canvas.ol-layer'),\n      function (canvas) {\n        if (canvas.width > 0) {\n          const opacity =\n            canvas.parentNode.style.opacity || canvas.style.opacity;\n          mapContext.globalAlpha = opacity === '' ? 1 : Number(opacity);\n\n          const backgroundColor = canvas.parentNode.style.backgroundColor;\n          if (backgroundColor) {\n            mapContext.fillStyle = backgroundColor;\n            mapContext.fillRect(0, 0, canvas.width, canvas.height);\n          }\n\n          let matrix;\n          const transform = canvas.style.transform;\n          if (transform) {\n            // Get the transform parameters from the style's transform matrix\n            matrix = transform\n              .match(/^matrix\\(([^\\(]*)\\)$/)[1]\n              .split(',')\n              .map(Number);\n          } else {\n            matrix = [\n              parseFloat(canvas.style.width) / canvas.width,\n              0,\n              0,\n              parseFloat(canvas.style.height) / canvas.height,\n              0,\n              0,\n            ];\n          }\n          // Apply the transform to the export map context\n          CanvasRenderingContext2D.prototype.setTransform.apply(\n            mapContext,\n            matrix\n          );\n          mapContext.drawImage(canvas, 0, 0);\n        }\n      }\n    );\n    mapContext.globalAlpha = 1;\n    if (navigator.msSaveBlob) {\n      // link download attribute does not work on MS browsers\n      navigator.msSaveBlob(mapCanvas.msToBlob(), 'map.png');\n    } else {\n      const link = document.getElementById('image-download');\n      link.href = mapCanvas.toDataURL();\n      link.click();\n    }\n  });\n  map.renderSync();\n});\n"],"names":["style","Style","fill","Fill","color","map","Map","layers","VectorLayer","source","VectorSource","url","format","GeoJSON","background","feature","asArray","get","getFill","setColor","HeatmapLayer","weight","radius","blur","opacity","target","view","View","center","zoom","document","getElementById","addEventListener","once","mapCanvas","createElement","size","getSize","width","height","mapContext","getContext","Array","prototype","forEach","call","getViewport","querySelectorAll","canvas","parentNode","globalAlpha","Number","matrix","backgroundColor","fillStyle","fillRect","transform","match","split","parseFloat","CanvasRenderingContext2D","setTransform","apply","drawImage","navigator","msSaveBlob","msToBlob","link","href","toDataURL","click","renderSync"],"sourceRoot":""}