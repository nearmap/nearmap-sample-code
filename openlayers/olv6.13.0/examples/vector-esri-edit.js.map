{"version":3,"file":"vector-esri-edit.js","mappings":"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","sources":["webpack:///./vector-esri-edit.js"],"sourcesContent":["import EsriJSON from '../src/ol/format/EsriJSON.js';\nimport Map from '../src/ol/Map.js';\nimport VectorSource from '../src/ol/source/Vector.js';\nimport View from '../src/ol/View.js';\nimport XYZ from '../src/ol/source/XYZ.js';\nimport {\n  Draw,\n  Modify,\n  Select,\n  defaults as defaultInteractions,\n} from '../src/ol/interaction.js';\nimport {Tile as TileLayer, Vector as VectorLayer} from '../src/ol/layer.js';\nimport {createXYZ} from '../src/ol/tilegrid.js';\nimport {fromLonLat} from '../src/ol/proj.js';\nimport {tile as tileStrategy} from '../src/ol/loadingstrategy.js';\n\nconst serviceUrl =\n  'https://sampleserver6.arcgisonline.com/arcgis/rest/services/Wildfire/FeatureServer/';\nconst layer = '2';\n\nconst esrijsonFormat = new EsriJSON();\n\nconst vectorSource = new VectorSource({\n  loader: function (extent, resolution, projection) {\n    const url =\n      serviceUrl +\n      layer +\n      '/query/?f=json&' +\n      'returnGeometry=true&spatialRel=esriSpatialRelIntersects&geometry=' +\n      encodeURIComponent(\n        '{\"xmin\":' +\n          extent[0] +\n          ',\"ymin\":' +\n          extent[1] +\n          ',\"xmax\":' +\n          extent[2] +\n          ',\"ymax\":' +\n          extent[3] +\n          ',\"spatialReference\":{\"wkid\":102100}}'\n      ) +\n      '&geometryType=esriGeometryEnvelope&inSR=102100&outFields=*' +\n      '&outSR=102100';\n    $.ajax({\n      url: url,\n      dataType: 'jsonp',\n      success: function (response) {\n        if (response.error) {\n          alert(\n            response.error.message + '\\n' + response.error.details.join('\\n')\n          );\n        } else {\n          // dataProjection will be read from document\n          const features = esrijsonFormat.readFeatures(response, {\n            featureProjection: projection,\n          });\n          if (features.length > 0) {\n            vectorSource.addFeatures(features);\n          }\n        }\n      },\n    });\n  },\n  strategy: tileStrategy(\n    createXYZ({\n      tileSize: 512,\n    })\n  ),\n});\n\nconst vector = new VectorLayer({\n  source: vectorSource,\n});\n\nconst raster = new TileLayer({\n  source: new XYZ({\n    attributions:\n      'Tiles Â© <a href=\"https://services.arcgisonline.com/ArcGIS/' +\n      'rest/services/World_Topo_Map/MapServer\">ArcGIS</a>',\n    url:\n      'https://server.arcgisonline.com/ArcGIS/rest/services/' +\n      'World_Topo_Map/MapServer/tile/{z}/{y}/{x}',\n  }),\n});\n\nconst draw = new Draw({\n  source: vectorSource,\n  type: 'Polygon',\n});\n\nconst select = new Select();\nselect.setActive(false);\nconst selected = select.getFeatures();\n\nconst modify = new Modify({\n  features: selected,\n});\nmodify.setActive(false);\n\nconst map = new Map({\n  interactions: defaultInteractions().extend([draw, select, modify]),\n  layers: [raster, vector],\n  target: document.getElementById('map'),\n  view: new View({\n    center: fromLonLat([-110.875, 37.345]),\n    zoom: 5,\n  }),\n});\n\nconst typeSelect = document.getElementById('type');\n\n/**\n * Let user change the interaction type.\n */\ntypeSelect.onchange = function () {\n  draw.setActive(typeSelect.value === 'DRAW');\n  select.setActive(typeSelect.value === 'MODIFY');\n  modify.setActive(typeSelect.value === 'MODIFY');\n};\n\nconst dirty = {};\n\nselected.on('add', function (evt) {\n  const feature = evt.element;\n  feature.on('change', function (evt) {\n    dirty[evt.target.get('objectid')] = true;\n  });\n});\n\nselected.on('remove', function (evt) {\n  const feature = evt.element;\n  const fid = feature.get('objectid');\n  if (dirty[fid] === true) {\n    const payload =\n      '[' +\n      esrijsonFormat.writeFeature(feature, {\n        featureProjection: map.getView().getProjection(),\n      }) +\n      ']';\n    const url = serviceUrl + layer + '/updateFeatures';\n    $.post(url, {f: 'json', features: payload}).done(function (data) {\n      const result = typeof data === 'string' ? JSON.parse(data) : data;\n      if (result.updateResults && result.updateResults.length > 0) {\n        if (result.updateResults[0].success !== true) {\n          const error = result.updateResults[0].error;\n          alert(error.description + ' (' + error.code + ')');\n        } else {\n          delete dirty[fid];\n        }\n      }\n    });\n  }\n});\n\ndraw.on('drawend', function (evt) {\n  const feature = evt.feature;\n  const payload =\n    '[' +\n    esrijsonFormat.writeFeature(feature, {\n      featureProjection: map.getView().getProjection(),\n    }) +\n    ']';\n  const url = serviceUrl + layer + '/addFeatures';\n  $.post(url, {f: 'json', features: payload}).done(function (data) {\n    const result = typeof data === 'string' ? JSON.parse(data) : data;\n    if (result.addResults && result.addResults.length > 0) {\n      if (result.addResults[0].success === true) {\n        feature.set('objectid', result.addResults[0]['objectId']);\n      } else {\n        const error = result.addResults[0].error;\n        alert(error.description + ' (' + error.code + ')');\n      }\n    }\n  });\n});\n"],"names":["serviceUrl","esrijsonFormat","EsriJSON","vectorSource","VectorSource","loader","extent","resolution","projection","url","encodeURIComponent","$","ajax","dataType","success","response","error","alert","message","details","join","features","readFeatures","featureProjection","length","addFeatures","strategy","tileStrategy","createXYZ","tileSize","vector","VectorLayer","source","raster","TileLayer","XYZ","attributions","draw","Draw","type","select","Select","setActive","selected","getFeatures","modify","Modify","map","Map","interactions","defaultInteractions","extend","layers","target","document","getElementById","view","View","center","fromLonLat","zoom","typeSelect","onchange","value","dirty","on","evt","element","get","feature","fid","payload","writeFeature","getView","getProjection","post","f","done","data","result","JSON","parse","updateResults","description","code","addResults","set"],"sourceRoot":""}